AT_SETUP([Undefined entry])

AT_DATA([prog.cob], [
       IDENTIFICATION  DIVISION.
       PROGRAM-ID.     prog.
       PROCEDURE       DIVISION.
         DISPLAY X.
         STOP RUN.
])

AT_CHECK([${COMPILE_ONLY} prog.cob], [1], ,
[prog.cob:5: error: `X' undefined
])

AT_CLEANUP


AT_SETUP([Redefinition of 01 entries (1)])

AT_DATA([prog.cob], [
       IDENTIFICATION  DIVISION.
       PROGRAM-ID.     prog.
       DATA            DIVISION.
       WORKING-STORAGE SECTION.
       01 X            PIC X.
       01 X            PIC X.
       PROCEDURE       DIVISION.
         STOP RUN.
])

AT_CHECK([${COMPILE_ONLY} prog.cob], [1], ,
[prog.cob:7: error: redefinition of `X'
prog.cob:6: error: `X' previously defined here
])

AT_CLEANUP


AT_SETUP([Redefinition of 01 entries (2)])

AT_DATA([prog.cob], [
       IDENTIFICATION  DIVISION.
       PROGRAM-ID.     prog.
       DATA            DIVISION.
       WORKING-STORAGE SECTION.
       01 X            PIC X.
       01 Y            PIC X.
       01 X            PIC X.
       PROCEDURE       DIVISION.
         STOP RUN.
])

AT_CHECK([${COMPILE_ONLY} prog.cob], [1], ,
[prog.cob:8: error: redefinition of `X'
prog.cob:6: error: `X' previously defined here
])

AT_CLEANUP


AT_SETUP([Redefinition of 01 and 02 entries])

AT_DATA([prog.cob], [
       IDENTIFICATION  DIVISION.
       PROGRAM-ID.     prog.
       DATA            DIVISION.
       WORKING-STORAGE SECTION.
       01 X.
         02 X          PIC X.
       PROCEDURE       DIVISION.
         STOP RUN.
])

AT_CHECK([${COMPILE_ONLY} prog.cob], [1], ,
[prog.cob:7: error: redefinition of `X'
prog.cob:6: error: `X' previously defined here
])

AT_CLEANUP


AT_SETUP([Redefinition of 02 entries (same group)])

AT_DATA([prog.cob], [
       IDENTIFICATION  DIVISION.
       PROGRAM-ID.     prog.
       DATA            DIVISION.
       WORKING-STORAGE SECTION.
       01 G.
         02 X          PIC X.
         02 X          PIC X.
       PROCEDURE       DIVISION.
         STOP RUN.
])

AT_CHECK([${COMPILE_ONLY} prog.cob], [1], ,
[prog.cob:8: error: redefinition of `X'
prog.cob:7: error: `X' previously defined here
])

AT_CLEANUP


AT_SETUP([Redefinition of 02 entries (different groups with reference)])

AT_DATA([prog.cob], [
       IDENTIFICATION  DIVISION.
       PROGRAM-ID.     prog.
       DATA            DIVISION.
       WORKING-STORAGE SECTION.
       01 G1.
         02 X          PIC X.
       01 G2.
         02 X          PIC X.
       PROCEDURE       DIVISION.
         DISPLAY X.
         STOP RUN.
])

AT_CHECK([${COMPILE_ONLY} prog.cob], [1], ,
[prog.cob:11: error: `X' ambiguous; need qualification
prog.cob:7: error: `X' in `G1' defined here
prog.cob:9: error: `X' in `G2' defined here
])

AT_CLEANUP


AT_SETUP([Redefinition of 77 entries])

AT_DATA([prog.cob], [
       IDENTIFICATION  DIVISION.
       PROGRAM-ID.     prog.
       DATA            DIVISION.
       WORKING-STORAGE SECTION.
       77 X            PIC X.
       77 X            PIC X.
       PROCEDURE       DIVISION.
         STOP RUN.
])

AT_CHECK([${COMPILE_ONLY} prog.cob], [1], ,
[prog.cob:7: error: redefinition of `X'
prog.cob:6: error: `X' previously defined here
])

AT_CLEANUP


AT_SETUP([Redefinition of 01 and 77 entries])

AT_DATA([prog.cob], [
       IDENTIFICATION  DIVISION.
       PROGRAM-ID.     prog.
       DATA            DIVISION.
       WORKING-STORAGE SECTION.
       01 X            PIC X.
       77 X            PIC X.
       PROCEDURE       DIVISION.
         STOP RUN.
])

AT_CHECK([${COMPILE_ONLY} prog.cob], [1], ,
[prog.cob:7: error: redefinition of `X'
prog.cob:6: error: `X' previously defined here
])

AT_CLEANUP
