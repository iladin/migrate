AT_SETUP([ENTRY])

AT_DATA([caller.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       PROCEDURE        DIVISION.
         CALL "hello" USING "COBOL".
         CALL "bye" USING "COBOL".
         STOP RUN.
])

AT_DATA([callee.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      hello.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 MSG-HELLO     PIC X(7) VALUE "Hello, ".
       01 MSG-BYE       PIC X(5) VALUE "Bye, ".
       LINKAGE          SECTION.
       01 X             PIC X(5).
       01 Y             PIC X(5).
       PROCEDURE        DIVISION USING X.
         DISPLAY MSG-HELLO X "!".
         EXIT PROGRAM.

         ENTRY "bye" USING Y.
         DISPLAY MSG-BYE Y "!".
         EXIT PROGRAM.
])

AT_CHECK([${COMPILE} -c -static -fmain caller.cob])
AT_CHECK([${COMPILE} -c -static callee.cob])
AT_CHECK([${COMPILE} -o prog caller.o callee.o])
AT_CHECK([./prog], [0],
[Hello, COBOL!
Bye, COBOL!
])

AT_CLEANUP
